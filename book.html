<!DOCTYPE html>
<html lang="ta">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>LawTamil Infinite Open Book - Auto Outro</title>
  <link href="https://fonts.googleapis.com/css2?family=Mukta+Malar:wght@400;700&display=swap" rel="stylesheet">
  <style>
    * { box-sizing: border-box; }

    body {
      margin: 0;
      display: flex;
      min-height: 100dvh;
      perspective: 1000px;
      font: 1.2em/1.6 "Mukta Malar", sans-serif;
      overflow: hidden;
      color: hsl(180 68% 5%);
      background-color: transparent; 
    }

    .book {
      position: relative;
      display: flex;
      margin: auto;
      width: 60vmin;
      pointer-events: none;
      transform-style: preserve-3d;
      translate: calc(min(var(--c), 1) * 50%) 0%;
      rotate: 1 0 0 30deg; 
    }

    .page {
      --thickness: 4;
      flex: none;
      display: flex;
      width: 100%;
      font-size: 2.5vmin;
      pointer-events: all;
      user-select: none;
      transform-style: preserve-3d;
      transform-origin: left center;
      transition:
        transform 1s,
        rotate 1s ease-in calc((min(var(--i), var(--c)) - max(var(--i), var(--c))) * 50ms);
      translate: calc(var(--i) * -100%) 0px 0px;
      transform: translateZ( calc((var(--c) - var(--i) - 0.5) * calc(var(--thickness) * .23vmin)));
      rotate: 0 1 0 calc(clamp(0, var(--c) - var(--i), 1) * -180deg);
      box-shadow: 0em .5em 1em -.2em #00000020;
    }

    .front,
    .back {
      position: relative;
      flex: none;
      width: 100%;
      backface-visibility: hidden;
      overflow: hidden;
      background-color: #fff;
      translate: 0px;
      display: flex;
      flex-flow: column wrap;
      justify-content: flex-start; 
      padding: 2.5em 2em;
      border: 1px solid #0002;
    }

    .back {
      translate: -100% 0;
      rotate: 0 1 0 180deg;
    }

    .front {
      background: linear-gradient(to left, #f7f7f7 80%, #eee 100%);
      border-radius: .1em .5em .5em .1em;
    }
    .back {
      background-image: linear-gradient(to right, #f7f7f7 80%, #eee 100%);
      border-radius: .5em .1em .1em .5em;
    }

    .content-text {
      text-align: justify;
      hyphens: auto;
      line-height: 1.8;
      margin: 0;
    }
    
    .loading-msg {
      font-size: 24px;
      color: #333;
      text-align: center;
      width: 100%;
      margin-top: 20%;
    }

    .page-number {
      position: absolute;
      bottom: 1em;
      font-size: 0.8em;
      color: #777;
    }
    .front .page-number { right: 1.5em; }
    .back .page-number { left: 1.5em; }
  </style>
</head>
<body>

  <div class="book" id="lawTamilBook">
      <div class="loading-msg">родро░ро╡рпБроХро│рпИ роПро▒рпНро▒рпБроХро┐ро▒родрпБ...</div>
  </div>

  <script>
    const charsPerPage = 400; 

    function handleBloggerFeed(data) {
      if(data.feed && data.feed.entry) {
        const post = data.feed.entry[0];
        const title = post.title.$t;
        
        const tempDiv = document.createElement('div');
        tempDiv.innerHTML = post.content ? post.content.$t : (post.summary ? post.summary.$t : "");
        
        const unwantedElements = tempDiv.querySelectorAll('script, style, noscript, iframe, meta, img, figure');
        unwantedElements.forEach(el => el.remove());
        
        const pureText = tempDiv.textContent || tempDiv.innerText || "";
        const cleanText = pureText.replace(/\s+/g, ' ').trim(); 
        
        const chunks = chunkText(cleanText, charsPerPage);
        buildBook(title, chunks);
      } else {
        document.getElementById('lawTamilBook').innerHTML = "<div class='loading-msg'>рокродро┐ро╡рпБроХро│рпН роХро┐роЯрпИроХрпНроХро╡ро┐ро▓рпНро▓рпИ.</div>";
      }
    }

    function fetchBloggerPosts() {
      const script = document.createElement('script');
      script.src = 'https://feed.rtbs.in/feeds/posts/default/-/jtype?alt=json-in-script&callback=handleBloggerFeed&max-results=1';
      document.body.appendChild(script);
    }

    function chunkText(text, limit) {
      const words = text.split(' ');
      let chunks = [];
      let currentChunk = '';
      
      for(let word of words) {
        if((currentChunk + word).length > limit) {
          chunks.push(currentChunk.trim());
          currentChunk = word + ' ';
        } else {
          currentChunk += word + ' ';
        }
      }
      if(currentChunk.trim().length > 0) chunks.push(currentChunk.trim());
      return chunks;
    }

    function buildBook(title, chunks) {
      const bookContainer = document.getElementById('lawTamilBook');
      let htmlContent = '';
      
      // роЕройрпИродрпНродрпБ родро░ро╡рпБроХро│рпИропрпБроорпН ро╡ро░ро┐роЪрпИрокрпНрокроЯрпБродрпНродрпБродро▓рпН
      let items = [{ text: title, isTitle: true }];
      chunks.forEach((chunk, index) => {
          items.push({ text: chunk, pageNum: index + 1 });
      });
      
      // роХро╛ро▓ро┐ропро╛роХ роЙро│рпНро│ роХроЯрпИроЪро┐рокрпН рокроХрпНроХродрпНродрпИ роиро┐ро░рокрпНрокрпБроорпН ро▓ро╛роЬро┐роХрпН (рокроХрпНроХроЩрпНроХро│рпН роТро▒рпНро▒рпИрокрпНрокроЯрпИропро╛роХ роЗро░рпБроирпНродро╛ро▓рпН)
      if (items.length % 2 !== 0) {
          items.push({ 
              text: `
                <div style="display: flex; flex-direction: column; justify-content: center; align-items: center; height: 100%; text-align: center; padding: 10px;">
                    <h3 style="color: #8b5a2b; font-size: 1.2em; margin-bottom: 15px; line-height: 1.4;">ро╡ро┐родро┐роХро│рпН роЕро▒ро┐ро╡рпЛроорпН, ро╡ро┐ро╡рпЗроХродрпНродрпБроЯройрпН роЪрпЖропро▓рпНрокроЯрпБро╡рпЛроорпН!</h3>
                    <p style="color: #3e2723; font-size: 1.1em; margin-bottom: 20px;">роЗродрпБ роироородрпБ <strong>роЪроЯрпНроЯро╡ро┐ропро▓рпН</strong>.</p>
                    <p style="font-size: 0.9em; line-height: 1.6; color: #444;">роорпЗро▓рпБроорпН рокропройрпБро│рпНро│ роЪроЯрпНроЯродрпН родроХро╡ро▓рпНроХро│рпБроХрпНроХрпБ <strong>'Jurisprudence Tamil'</strong> роЪрпЗройро▓рпБроХрпНроХрпБ роЪрокрпНро╕рпНроХро┐ро░рпИрокрпН роЪрпЖропрпНроп рооро▒роХрпНроХро╛родрпАро░рпНроХро│рпН.</p>
                    <p style="font-size: 0.9em; color: #d32f2f; font-weight: bold; margin-top: 15px; margin-bottom: 20px;">ЁЯСН роЕрокрпНрокроЯро┐ропрпЗ роЗроирпНрод ро╡рпАроЯро┐ропрпЛро╡рпИ ро▓рпИроХрпН рооро▒рпНро▒рпБроорпН ро╖рпЗро░рпН роЪрпЖропрпНропрпБроЩрпНроХро│рпН!</p>
                    <div style="width: 40px; height: 2px; background: #8b5a2b; margin-bottom: 10px;"></div>
                    <p style="font-size: 0.8em; color: #555;">роорпЗро▓рпБроорпН ро╡ро┐ро╡ро░роЩрпНроХро│рпБроХрпНроХрпБ: <strong style="color: #0066cc;">lawtamil.in</strong></p>
                </div>
              `, 
              isOutro: true 
          });
      }
      
      let totalSpreads = Math.ceil(items.length / 2);

      // Page 0 - родро┐ро▒роирпНрод рокрпБродрпНродроХродрпНродро┐ройрпН роЗроЯродрпБрокрпБро▒роорпН (родро▓рпИрокрпНрокрпБ)
      htmlContent += `
        <div class="page">
          <div class="front" style="background: transparent; border: none; box-shadow: none;"></div>
          <div class="back" style="display:flex; flex-direction: column; justify-content:center; align-items:center; text-align:center;">
            <h2 style="color: #8b5a2b; font-size: 1.6em; margin-bottom: 20px; padding: 0 10px; line-height: 1.4;">${items[0].text}</h2>
            <div style="width: 60px; height: 3px; background: #8b5a2b;"></div>
          </div>
        </div>
      `;

      // роЙро│рпНро│роЯроХрпНроХрокрпН рокроХрпНроХроЩрпНроХро│рпН & Outro
      for(let i = 1; i <= totalSpreads; i++) {
        let frontItem = items[i * 2 - 1]; // ро╡ро▓родрпБ рокроХрпНроХроорпН
        let backItem = items[i * 2];      // роЗроЯродрпБ рокроХрпНроХроорпН

        // Outro роЖроХ роЗро░рпБроирпНродро╛ро▓рпН роЕрокрпНрокроЯро┐ропрпЗ HTML-роРрокрпН рокропройрпНрокроЯрпБродрпНродрпБроХро┐ро▒рпЛроорпН, роЗро▓рпНро▓рпИропрпЖройро┐ро▓рпН роЪро╛родро╛ро░рог роЙро░рпИ
        let frontText = frontItem ? (frontItem.isOutro ? frontItem.text : `<p class="content-text">${frontItem.text}</p>`) : "";
        let backText = backItem ? (backItem.isOutro ? backItem.text : `<p class="content-text">${backItem.text}</p>`) : "";
        
        let frontNumHtml = (frontItem && frontItem.pageNum && !frontItem.isOutro) ? `<div class="page-number">${frontItem.pageNum}</div>` : '';
        let backNumHtml = (backItem && backItem.pageNum && !backItem.isOutro) ? `<div class="page-number">${backItem.pageNum}</div>` : '';

        htmlContent += `
          <div class="page">
            <div class="front">
                ${frontText}
                ${frontNumHtml}
            </div>
            <div class="back">
                ${backText}
                ${backNumHtml}
            </div>
          </div>
        `;
      }

      bookContainer.innerHTML = htmlContent;
      initFlipBook(bookContainer, totalSpreads);
    }

    function initFlipBook(elBook, totalSpreads) {
      let currentPage = 1; 
      const pages = elBook.querySelectorAll(".page");
      
      pages.forEach((page, idx) => {
        page.style.setProperty("--i", idx);
      });
      elBook.style.setProperty("--c", currentPage); 

      setInterval(() => {
        currentPage++;
        
        if(currentPage > totalSpreads) {
          pages.forEach(p => p.style.transition = 'none');
          currentPage = 1; 
          elBook.style.setProperty("--c", currentPage);
          
          void elBook.offsetWidth; 
          
          setTimeout(() => {
              pages.forEach(p => p.style.transition = '');
          }, 50); 
          
        } else {
          elBook.style.setProperty("--c", currentPage);
        }
      }, 6000); 
    }

    window.onload = fetchBloggerPosts;
  </script>

</body>
</html>
